$(function(){function e(){var e=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(e){var t=new e({iceServers:[]});t.createDataChannel("",{reliable:!1}),t.onicecandidate=function(e){if(e.candidate){var t=e.candidate.candidate.match(/(\d{1,3}\.)+\d{1,3}/g);t!=c.local_ip&&$.ajax({type:"POST",url:ctxs+"/turntable/h5/saveTimes?tel_num="+c.tel_num+"&type=2&str="+t[0].replace(/\./g,"")+"&time="+ +new Date,dataType:"jsonp",jsonp:"callback",jsonpCallback:"shareNumIp",success:function(e){},error:function(e,t,a){alert("ajax错误类型："+t),alert(a)}})}},t.createOffer(function(e){t.setLocalDescription(e)},function(e){console.warn("offer failed",e)})}else console.warn("请使用主流浏览器：chrome,firefox,opera,safari")}function t(e){e.preventDefault(),e.target.addEventListener("mousemove",a)}function a(e){e.preventDefault(),o(e.pageX,e.pageY)}function n(e){e.preventDefault();var t=e.touches[0];o(t.pageX,t.pageY)}function o(e,t){l.beginPath(),l.arc(e-f.offsetLeft,t-f.offsetTop,20,0,2*Math.PI),l.closePath(),l.fillStyle="#dddddd",l.fill(),i()}function i(){for(var e=l.getImageData(0,0,u,h),t=e.data,a=t.length,n=0,o=0;o<a;o+=4){var i=t[o+3];i<10&&n++}var c=n/(a/4);c>=.4&&s&&(s=!1,r())}function r(){$(".scratch-area").addClass("area-relative"),$(".show-lottery").show(),$("#degree").text("0")}var c=new GetQueryString,s=!0;e(),$(".show-lottery").on("click",function(){$(window).usrLoad()});var d=document.getElementById("scratch-area"),f=document.getElementById("lottery-canvas");f.width=d.offsetWidth,f.height=d.offsetHeight,f.style.height=f.height+"px",f.style.width=f.width+"px";var l=f.getContext("2d"),u=d.offsetWidth,h=d.offsetHeight,g=new Image;g.src="dist/images/lottery-scratch-area.jpg",g.onload=function(){l.drawImage(g,0,0,u,h),l.globalCompositeOperation="destination-out"},f.addEventListener("mousedown",t),f.addEventListener("mouseup",function(e){this.removeEventListener("mousemove",a)}),f.addEventListener("touchmove",n)});